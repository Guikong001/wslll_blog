{% extends 'simple_white/base.html' %}

{% block title %}{% if post %}{% if current_lang == 'zh' %}编辑文章{% else %}Edit Post{% endif %}{% else %}{% if current_lang == 'zh' %}新建文章{% else %}New Post{% endif %}{% endif %}{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <div class="bg-white border border-gray-200 rounded-3xl p-10 shadow-xl">
        <h2 class="text-3xl font-bold font-mono mb-10 text-black tracking-tight">
            {% if post %}
                {% if current_lang == 'zh' %}编辑文章{% else %}EDIT POST{% endif %}
            {% else %}
                {% if current_lang == 'zh' %}新建文章{% else %}NEW POST{% endif %}
            {% endif %}
        </h2>
        
        <form method="POST">
            <div class="mb-8">
                <label class="block text-gray-500 font-mono text-xs font-bold mb-2 uppercase tracking-wider">
                    {% if current_lang == 'zh' %}标题{% else %}TITLE{% endif %}
                </label>
                <input type="text" name="title" placeholder="{% if current_lang == 'zh' %}输入标题...{% else %}ENTER TITLE...{% endif %}" required value="{{ post.title if post else '' }}"
                    class="w-full bg-gray-50 border border-gray-200 rounded-xl p-4 text-xl font-bold text-black focus:border-black focus:ring-0 focus:outline-none font-mono transition-colors placeholder-gray-400">
            </div>
            
            <div class="mb-8 grid md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-gray-500 font-mono text-xs font-bold mb-2 uppercase tracking-wider">
                        {% if current_lang == 'zh' %}作者 (可选){% else %}AUTHOR (OPTIONAL){% endif %}
                    </label>
                    <input type="text" name="custom_author" value="{{ post.custom_author if post and post.custom_author else '' }}" placeholder="{{ current_user.username }}"
                        class="w-full bg-gray-50 border border-gray-200 rounded-lg p-3 text-black focus:border-black focus:ring-0 focus:outline-none font-mono">
                </div>
                <div>
                    <label class="block text-gray-500 font-mono text-xs font-bold mb-2 uppercase tracking-wider">
                        {% if current_lang == 'zh' %}发布时间{% else %}PUBLISH DATE{% endif %}
                    </label>
                    <input type="datetime-local" name="created_at" value="{{ post.created_at.strftime('%Y-%m-%dT%H:%M') if post else '' }}"
                        class="w-full bg-gray-50 border border-gray-200 rounded-lg p-3 text-black focus:border-black focus:ring-0 focus:outline-none font-mono transition-colors">
                </div>
            </div>

            <div class="mb-8 grid md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-gray-500 font-mono text-xs font-bold mb-2 uppercase tracking-wider">
                        {% if current_lang == 'zh' %}分类{% else %}CATEGORY{% endif %}
                    </label>
                    <select name="category_id" class="w-full bg-gray-50 border border-gray-200 rounded-lg p-3 text-black focus:border-black focus:ring-0 focus:outline-none font-mono">
                        <option value="">{% if current_lang == 'zh' %}-- 选择分类 --{% else %}-- SELECT CATEGORY --{% endif %}</option>
                        {% for cat in categories %}
                        <option value="{{ cat.id }}" {% if post and post.category_id == cat.id %}selected{% endif %}>{{ cat.name }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label class="block text-gray-500 font-mono text-xs font-bold mb-2 uppercase tracking-wider">
                        {% if current_lang == 'zh' %}或创建新分类{% else %}OR CREATE NEW CATEGORY{% endif %}
                    </label>
                    <input type="text" name="new_category" placeholder="{% if current_lang == 'zh' %}新分类名称{% else %}NEW CATEGORY NAME{% endif %}"
                        class="w-full bg-gray-50 border border-gray-200 rounded-lg p-3 text-black focus:border-black focus:ring-0 focus:outline-none font-mono transition-colors">
                </div>
            </div>
            
            <div class="mb-10 prose-editor">
                <label class="block text-gray-500 font-mono text-xs font-bold mb-2 uppercase tracking-wider">
                    {% if current_lang == 'zh' %}内容{% else %}CONTENT{% endif %}
                </label>
                <textarea name="content" id="markdown-editor">{{ post.content if post else '' }}</textarea>
            </div>
            
            <div class="flex justify-end space-x-4">
                <a href="{{ url_for('index') }}" class="px-6 py-3 border border-gray-200 rounded-xl text-gray-500 hover:text-black hover:border-black transition-colors font-mono font-bold text-sm">
                    {% if current_lang == 'zh' %}取消{% else %}CANCEL{% endif %}
                </a>
                <button type="submit" class="px-8 py-3 bg-black text-white font-bold rounded-xl hover:bg-gray-800 transition-all duration-300 font-mono shadow-lg text-sm tracking-widest">
                    {% if post %}
                        {% if current_lang == 'zh' %}更新{% else %}UPDATE{% endif %}
                    {% else %}
                        {% if current_lang == 'zh' %}发布{% else %}PUBLISH{% endif %}
                    {% endif %}
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    var simplemde = new SimpleMDE({ 
        element: document.getElementById("markdown-editor"),
        spellChecker: false,
        status: false,
        styleSelectedText: false,
        toolbar: ["bold", "italic", "heading", "|", "quote", "code", "unordered-list", "ordered-list", "|", "link", "image", "|", "preview", "side-by-side", "fullscreen"],
    });
</script>
{% endblock %}
