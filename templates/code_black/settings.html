{% extends 'code_black/base.html' %}

{% block title %}{% if current_lang == 'zh' %}设置{% else %}Settings{% endif %}{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <div class="bg-card-bg border-2 border-white p-8 shadow-neo-pink">
        <h2 class="text-3xl font-bold font-mono mb-8 text-neon-pink text-center">
            {% if current_lang == 'zh' %}系统设置{% else %}SYSTEM SETTINGS{% endif %}
        </h2>
        
        <form method="POST" enctype="multipart/form-data">
            <!-- Theme Selection -->
            <div class="mb-8 pb-8 border-b border-gray-700">
                <h3 class="text-xl font-bold font-mono mb-4 text-neon-blue">
                    {% if current_lang == 'zh' %}主题设置{% else %}THEME SETTINGS{% endif %}
                </h3>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <label class="relative cursor-pointer group">
                        <input type="radio" name="theme" value="dark" class="peer sr-only" {% if settings.theme == 'dark' %}checked{% endif %}>
                        <div class="p-4 border-2 transition-all duration-300 peer-checked:border-neon-yellow peer-checked:bg-gray-800 border-gray-600 hover:border-white bg-dark-bg h-full">
                            <div class="font-mono font-bold text-white mb-1">CYBERPUNK DARK</div>
                            <div class="text-xs text-gray-400 font-mono">High contrast, neon accents.</div>
                            <div class="mt-2 flex gap-1">
                                <div class="w-3 h-3 bg-[#FF005C]"></div>
                                <div class="w-3 h-3 bg-[#F5FF00]"></div>
                                <div class="w-3 h-3 bg-[#00F0FF]"></div>
                            </div>
                        </div>
                        <div class="absolute top-2 right-2 opacity-0 peer-checked:opacity-100 transition-opacity">
                            <i class="fas fa-check-circle text-neon-yellow"></i>
                        </div>
                    </label>
                    
                    <label class="relative cursor-pointer group">
                        <input type="radio" name="theme" value="white" class="peer sr-only" {% if settings.theme == 'white' %}checked{% endif %}>
                        <div class="p-4 border-2 transition-all duration-300 peer-checked:border-neon-yellow peer-checked:bg-gray-800 border-gray-600 hover:border-white bg-white h-full">
                            <div class="font-mono font-bold text-black mb-1">MINIMALIST WHITE</div>
                            <div class="text-xs text-gray-600 font-mono">Clean, spacious, light.</div>
                            <div class="mt-2 flex gap-1">
                                <div class="w-3 h-3 bg-black"></div>
                                <div class="w-3 h-3 bg-gray-300"></div>
                                <div class="w-3 h-3 bg-white border border-gray-300"></div>
                            </div>
                        </div>
                        <div class="absolute top-2 right-2 opacity-0 peer-checked:opacity-100 transition-opacity">
                            <i class="fas fa-check-circle text-black"></i>
                        </div>
                    </label>
                </div>
            </div>

            <div class="mb-8">class="mb-6">
                <label class="block text-gray-400 font-mono text-sm mb-2">
                    {% if current_lang == 'zh' %}博客名称{% else %}BLOG NAME{% endif %}
                </label>
                <input type="text" name="blog_name" value="{{ settings.blog_name }}" required
                    class="w-full bg-dark-bg border-2 border-gray-600 p-3 text-white focus:border-neon-yellow focus:outline-none font-mono transition-colors">
            </div>

            <div class="mb-6">
                <label class="block text-gray-400 font-mono text-sm mb-2">
                    {% if current_lang == 'zh' %}DeepSeek API 密钥{% else %}DEEPSEEK API KEY{% endif %}
                </label>
                <input type="password" name="deepseek_api_key" value="{{ settings.deepseek_api_key if settings.deepseek_api_key else '' }}" placeholder="sk-..."
                    class="w-full bg-dark-bg border-2 border-gray-600 p-3 text-white focus:border-neon-yellow focus:outline-none font-mono transition-colors">
            </div>

            <div class="mb-6">
                <label class="block text-gray-400 font-mono text-sm mb-2">
                    {% if current_lang == 'zh' %}LOGO (图片){% else %}LOGO (IMAGE){% endif %}
                </label>
                {% if settings.logo_filename %}
                <div class="mb-2">
                    <img src="{{ url_for('static', filename='uploads/logo/' + settings.logo_filename) }}" alt="Current Logo" class="h-16 w-auto border border-gray-700 p-1">
                </div>
                {% endif %}
                <input type="file" name="logo" accept="image/*"
                    class="w-full bg-dark-bg border-2 border-gray-600 p-3 text-gray-400 focus:border-neon-yellow focus:outline-none font-mono transition-colors file:mr-4 file:py-2 file:px-4 file:border-0 file:text-sm file:font-mono file:bg-neon-pink file:text-black hover:file:bg-white">
            </div>
            
            <div class="mb-8">
                <label class="block text-gray-400 font-mono text-sm mb-2">
                    {% if current_lang == 'zh' %}全局通知内容 (支持 Markdown, 使用 &lt;notice&gt; 标签包裹多个通知){% else %}GLOBAL NOTIFICATION CONTENT (MARKDOWN SUPPORTED, USE &lt;notice&gt; TAGS FOR MULTIPLE){% endif %}
                </label>
                <textarea name="notification_content" id="notification-editor" rows="5"
                    class="w-full bg-dark-bg border-2 border-gray-600 p-3 text-white focus:border-neon-blue focus:outline-none font-mono transition-colors">{{ settings.notification_content if settings.notification_content else '' }}</textarea>
            </div>

            <div class="mb-8">
                <label class="block text-gray-400 font-mono text-sm mb-2">
                    {% if current_lang == 'zh' %}关于我 (MARKDOWN){% else %}ABOUT ME (MARKDOWN){% endif %}
                </label>
                <textarea name="about_content" id="about-editor" rows="10"
                    class="w-full bg-dark-bg border-2 border-gray-600 p-3 text-white focus:border-neon-blue focus:outline-none font-mono transition-colors">{{ settings.about_content }}</textarea>
            </div>

            <div class="mb-8">
                <label class="block text-gray-400 font-mono text-sm mb-2">
                    {% if current_lang == 'zh' %}社交链接{% else %}SOCIAL LINKS{% endif %}
                </label>
                <div id="social-links-container">
                    {% for link in settings.get_social_links() %}
                    <div class="flex gap-2 mb-2 social-row">
                        <input type="text" name="social_icon[]" placeholder="Icon (e.g., fab fa-github)" value="{{ link.icon }}"
                            class="w-1/3 bg-dark-bg border-2 border-gray-600 p-2 text-white focus:border-neon-yellow focus:outline-none font-mono text-sm">
                        <input type="text" name="social_url[]" placeholder="URL" value="{{ link.url }}"
                            class="w-2/3 bg-dark-bg border-2 border-gray-600 p-2 text-white focus:border-neon-yellow focus:outline-none font-mono text-sm">
                        <button type="button" onclick="this.parentElement.remove()" class="bg-red-600 text-white px-3 hover:bg-red-700 font-mono">X</button>
                    </div>
                    {% endfor %}
                </div>
                <button type="button" id="add-link-btn" class="mt-2 text-sm text-neon-blue hover:text-white font-mono border border-neon-blue px-2 py-1 hover:bg-neon-blue hover:text-black transition-colors">
                    + {% if current_lang == 'zh' %}添加链接{% else %}ADD LINK{% endif %}
                </button>
                <p class="text-xs text-gray-500 mt-2 font-mono">
                    Icons use FontAwesome classes (e.g., <code>fab fa-github</code>, <code>fab fa-twitter</code>, <code>fas fa-envelope</code>, <code>fab fa-weixin</code>).
                    <a href="https://fontawesome.com/search?m=free" target="_blank" class="text-neon-blue hover:underline">Search Icons</a>
                </p>
            </div>
            
            <button type="submit" class="w-full bg-white text-black font-bold py-3 border-2 border-transparent hover:bg-neon-pink hover:text-white hover:border-white transition-all duration-300 font-mono shadow-lg">
                {% if current_lang == 'zh' %}保存更改{% else %}SAVE CHANGES{% endif %}
            </button>
        </form>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    var simplemde = new SimpleMDE({ 
        element: document.getElementById("about-editor"),
        spellChecker: false,
        status: false,
        toolbar: ["bold", "italic", "heading", "|", "quote", "unordered-list", "link", "preview"],
    });

    document.getElementById('add-link-btn').addEventListener('click', function() {
        const container = document.getElementById('social-links-container');
        const div = document.createElement('div');
        div.className = 'flex gap-2 mb-2 social-row';
        div.innerHTML = `
            <input type="text" name="social_icon[]" placeholder="Icon (e.g., fab fa-github)"
                class="w-1/3 bg-dark-bg border-2 border-gray-600 p-2 text-white focus:border-neon-yellow focus:outline-none font-mono text-sm">
            <input type="text" name="social_url[]" placeholder="URL"
                class="w-2/3 bg-dark-bg border-2 border-gray-600 p-2 text-white focus:border-neon-yellow focus:outline-none font-mono text-sm">
            <button type="button" onclick="this.parentElement.remove()" class="bg-red-600 text-white px-3 hover:bg-red-700 font-mono">X</button>
        `;
        container.appendChild(div);
    });
</script>
{% endblock %}
