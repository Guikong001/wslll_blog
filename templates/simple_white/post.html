{% extends 'simple_white/base.html' %}

{% block title %}{{ post.display_title }} - {{ site_settings.blog_name }}{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">
    <article class="bg-white">
        <header class="mb-10 pb-10 border-b border-gray-100">
            <div class="flex justify-between items-center mb-8">
                <a href="{{ url_for('index') }}" class="text-gray-400 hover:text-black transition-colors font-mono text-sm flex items-center gap-2 group">
                    <i class="fas fa-arrow-left text-xs group-hover:-translate-x-1 transition-transform"></i>
                    {% if current_lang == 'zh' %}返回{% else %}BACK{% endif %}
                </a>
                <span class="font-mono text-gray-400 text-sm">{{ post.created_at.strftime('%Y-%m-%d') }}</span>
            </div>
            
            <h1 class="text-3xl md:text-5xl font-bold font-mono mb-6 text-black leading-tight tracking-tight">
                {{ post.display_title }}
            </h1>
            
            <div class="flex items-center text-sm text-gray-500 font-mono gap-4">
                <div class="flex items-center gap-2">
                    <div class="w-6 h-6 bg-gray-100 rounded-full flex items-center justify-center text-gray-600">
                        <i class="fas fa-user text-xs"></i>
                    </div>
                    <span class="font-medium text-black">
                        {% if post.custom_author %}
                            {{ post.custom_author }}
                        {% else %}
                            {{ post.author.username }}
                        {% endif %}
                    </span>
                </div>
                {% if post.category %}
                <span class="text-gray-300">|</span>
                <a href="{{ url_for('index', category=post.category.id) }}" class="text-gray-500 hover:text-black transition-colors">
                    {{ post.category.name }}
                </a>
                {% endif %}
            </div>
        </header>

        <!-- AI Summary Section -->
        {% if (current_lang == 'zh' and post.summary_zh) or (current_lang == 'en' and post.summary_en) %}
        <div class="mb-12 bg-gray-50 rounded-2xl p-6 border border-gray-100 relative overflow-hidden">
            <div class="absolute top-0 left-0 w-1 h-full bg-black"></div>
            <h3 class="text-xs font-bold font-mono text-gray-400 mb-3 uppercase tracking-wider flex items-center gap-2">
                <i class="fas fa-robot"></i> {% if current_lang == 'zh' %}AI 摘要{% else %}AI Summary{% endif %}
            </h3>
            <div class="prose prose-sm max-w-none text-gray-600 italic" id="ai-summary-content">
                <!-- Content typed via JS -->
            </div>
            <!-- Hidden raw content for typing effect -->
            <div id="raw-summary" class="hidden">
                {% if current_lang == 'zh' %}
                    {{ post.summary_zh }}
                {% else %}
                    {{ post.summary_en }}
                {% endif %}
            </div>
        </div>
        {% endif %}

        <div class="prose prose-lg max-w-none prose-headings:font-mono prose-a:text-black prose-a:no-underline prose-a:border-b prose-a:border-black hover:prose-a:text-gray-600 hover:prose-a:border-gray-400 prose-img:rounded-xl prose-img:shadow-lg">
            {{ post.html_content|safe }}
        </div>
        
        {% if current_user.is_authenticated %}
        <div class="mt-12 pt-8 border-t border-gray-100 flex justify-end gap-4">
            <a href="{{ url_for('edit_post', post_id=post.id) }}" class="px-5 py-2 border border-gray-200 rounded-full text-gray-600 hover:bg-black hover:text-white hover:border-black transition-all font-mono text-sm font-bold">
                {% if current_lang == 'zh' %}编辑{% else %}EDIT{% endif %}
            </a>
            <form action="{{ url_for('delete_post', post_id=post.id) }}" method="POST" onsubmit="return confirm('{% if current_lang == 'zh' %}确定要删除吗？{% else %}Are you sure you want to delete this protocol?{% endif %}');">
                <button type="submit" class="px-5 py-2 border border-red-200 rounded-full text-red-500 hover:bg-red-500 hover:text-white hover:border-red-500 transition-all font-mono text-sm font-bold">
                    {% if current_lang == 'zh' %}删除{% else %}DELETE{% endif %}
                </button>
            </form>
        </div>
        {% endif %}
    </article>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const summaryContent = document.getElementById('ai-summary-content');
    const rawSummary = document.getElementById('raw-summary');
    
    if (summaryContent && rawSummary) {
        const text = rawSummary.textContent.trim();
        let index = 0;
        
        function typeWriter() {
            if (index < text.length) {
                summaryContent.textContent += text.charAt(index);
                index++;
                setTimeout(typeWriter, 20); 
            }
        }
        
        typeWriter();
    }
});
</script>
{% endblock %}
